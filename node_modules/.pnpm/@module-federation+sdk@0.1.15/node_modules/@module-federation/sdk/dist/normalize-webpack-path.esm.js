import path from 'path';

function getWebpackPath(compiler) {
    var options = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : {
        framework: 'other'
    };
    try {
        // @ts-ignore just throw err
        compiler.webpack();
        return '';
    } catch (err) {
        var _err_stack;
        var trace = ((_err_stack = err.stack) === null || _err_stack === void 0 ? void 0 : _err_stack.split('\n')) || [];
        var webpackErrLocation = trace.find(function(item) {
            return item.includes('at webpack');
        }) || '';
        var webpackLocationWithDetail = webpackErrLocation.replace(/[^\(\)]+/, '').slice(1, -1);
        var webpackPath = webpackLocationWithDetail.split(':').slice(0, -2).join(':');
        if ((options === null || options === void 0 ? void 0 : options.framework) === 'nextjs') {
            if (webpackPath.endsWith('webpack.js')) {
                return webpackPath.replace('webpack.js', 'index.js');
            }
            return '';
        }
        return require.resolve('webpack', {
            paths: [
                webpackPath
            ]
        });
    }
}
var normalizeWebpackPath = function(fullPath) {
    if (fullPath === 'webpack') {
        return process.env['FEDERATION_WEBPACK_PATH'] || fullPath;
    }
    if (process.env['FEDERATION_WEBPACK_PATH']) {
        return path.resolve(process.env['FEDERATION_WEBPACK_PATH'], fullPath.replace('webpack', '../../'));
    }
    return fullPath;
};

export { getWebpackPath, normalizeWebpackPath };
